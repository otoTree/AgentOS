<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1450 1100">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#64748b" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
      <feOffset dx="2" dy="2" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.1"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode in="offsetblur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#ffffff" />

  <!-- Header -->
  <text x="725" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1e293b">AgentOS System Architecture</text>
  <text x="725" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#64748b">Unified Platform for Agent Orchestration, Execution &amp; Delivery</text>

  <!-- ================================================================================== -->
  <!-- LAYER 1: CLIENTS & ENTRY POINTS (PRESENTATION) -->
  <!-- ================================================================================== -->
  
  <g transform="translate(50, 100)">
    <rect x="0" y="0" width="1350" height="140" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1" rx="8" />
    <text x="20" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#94a3b8">PRESENTATION LAYER</text>
    
    <!-- User Node -->
    <g transform="translate(30, 50)">
        <circle cx="30" cy="30" r="25" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2" filter="url(#shadow)"/>
        <!-- Smile -->
        <path d="M18,38 Q30,52 42,38" fill="none" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round" />
        <circle cx="22" cy="25" r="3" fill="#0ea5e9" />
        <circle cx="38" cy="25" r="3" fill="#0ea5e9" />
        <text x="30" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#334155">User</text>
    </g>

    <!-- AgentOS Web App -->
    <g transform="translate(130, 40)">
        <rect x="0" y="0" width="260" height="80" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
        <text x="130" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#1e3a8a" font-size="14">AgentOS Web Client</text>
        <text x="130" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">projects/app (Next.js)</text>
        
        <!-- Sub-components -->
        <g transform="translate(10, 45)">
            <rect x="0" y="0" width="70" height="25" rx="4" fill="#dbeafe" stroke="#93c5fd" />
            <text x="35" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Workbench</text>
        </g>
        <g transform="translate(90, 45)">
            <rect x="0" y="0" width="70" height="25" rx="4" fill="#dbeafe" stroke="#93c5fd" />
            <text x="35" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Chat UI</text>
        </g>
        <g transform="translate(170, 45)">
            <rect x="0" y="0" width="70" height="25" rx="4" fill="#dbeafe" stroke="#93c5fd" />
            <text x="35" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Admin</text>
        </g>
    </g>

    <!-- Generated Agent UI -->
    <g transform="translate(420, 40)">
        <rect x="0" y="0" width="200" height="80" rx="6" fill="#fefce8" stroke="#eab308" stroke-width="2" filter="url(#shadow)"/>
        <text x="100" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#713f12" font-size="14">Generated Apps</text>
        <text x="100" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#854d0e">Standalone Binaries</text>
        <g transform="translate(20, 45)">
             <rect x="0" y="0" width="160" height="25" rx="4" fill="#fef08a" stroke="#fde047" />
             <text x="80" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#854d0e">Native UI+API</text>
        </g>
    </g>

    <!-- Channels Integration (New) -->
    <g transform="translate(650, 40)">
        <rect x="0" y="0" width="280" height="80" rx="6" fill="#f0fdf4" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
        <text x="140" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#14532d" font-size="14">Channel Integrations</text>
        <text x="140" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#15803d">Multi-platform Delivery</text>
        
        <g transform="translate(10, 45)">
            <rect x="0" y="0" width="80" height="25" rx="4" fill="#dcfce7" stroke="#86efac" />
            <text x="40" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">WeCom/Ding</text>
        </g>
        <g transform="translate(100, 45)">
            <rect x="0" y="0" width="80" height="25" rx="4" fill="#dcfce7" stroke="#86efac" />
            <text x="40" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">Email/SMTP</text>
        </g>
        <g transform="translate(190, 45)">
            <rect x="0" y="0" width="80" height="25" rx="4" fill="#dcfce7" stroke="#86efac" />
            <text x="40" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">Feishu</text>
        </g>
    </g>

    <!-- External Consumers -->
    <g transform="translate(960, 40)">
        <rect x="0" y="0" width="160" height="80" rx="6" fill="#f3e8ff" stroke="#a855f7" stroke-width="2" filter="url(#shadow)"/>
        <text x="80" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#581c87" font-size="14">External API</text>
        <text x="80" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#6b21a8">SDK / Rest API</text>
    </g>
  </g>

  <!-- ================================================================================== -->
  <!-- LAYER 2: CORE PLATFORM SERVICES -->
  <!-- ================================================================================== -->

  <g transform="translate(50, 280)">
    
    <!-- AgentOS Server (Main) -->
    <g transform="translate(0, 0)">
        <rect x="0" y="0" width="760" height="580" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2" rx="10" filter="url(#shadow)"/>
        <text x="20" y="30" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#5b21b6">AgentOS Server</text>
        <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#7c3aed">Core Logic &amp; API (projects/app + packages/service)</text>

        <!-- Top Row: Gateways -->
        <g transform="translate(30, 50)">
            <!-- API Gateway -->
            <rect x="0" y="0" width="400" height="40" rx="4" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
            <text x="200" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#5b21b6" font-size="12">API Gateway (Auth / RateLimit / WS)</text>
            
            <!-- IAM/RBAC -->
            <g transform="translate(420, 0)">
                <rect x="0" y="0" width="280" height="40" rx="4" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
                <text x="140" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#5b21b6" font-size="12">IAM &amp; RBAC (Multi-tenant)</text>
            </g>
        </g>

        <!-- Inner Modules Grid -->
        <g transform="translate(30, 110)">
            
            <!-- Row 1: Execution & Runtime -->
            <g transform="translate(0, 0)">
                <!-- Execution Engine -->
                <rect x="0" y="0" width="340" height="130" rx="6" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
                <text x="15" y="20" font-family="Arial, sans-serif" font-weight="bold" fill="#4c1d95" font-size="13">Execution Engine</text>
                
                <g transform="translate(10, 30)">
                    <rect x="0" y="0" width="100" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="50" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Dispatcher</text>
                </g>
                <g transform="translate(115, 30)">
                    <rect x="0" y="0" width="100" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="50" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Job Queue</text>
                </g>
                <g transform="translate(220, 30)">
                    <rect x="0" y="0" width="110" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="55" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Scheduler/Cron</text>
                </g>
                <g transform="translate(10, 70)">
                    <rect x="0" y="0" width="155" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="77" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Task State Mgr</text>
                </g>
                <g transform="translate(175, 70)">
                    <rect x="0" y="0" width="155" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="77" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Task Agent Worker</text>
                </g>
            </g>

            <g transform="translate(360, 0)">
                <!-- Agent Runtime -->
                <rect x="0" y="0" width="340" height="130" rx="6" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
                <text x="15" y="20" font-family="Arial, sans-serif" font-weight="bold" fill="#4c1d95" font-size="13">Agent Runtime</text>
                
                <g transform="translate(10, 30)">
                    <rect x="0" y="0" width="100" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="50" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Context Mgr</text>
                </g>
                <g transform="translate(115, 30)">
                    <rect x="0" y="0" width="100" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="50" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Memory</text>
                </g>
                <g transform="translate(220, 30)">
                    <rect x="0" y="0" width="110" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="55" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">File System</text>
                </g>
                <g transform="translate(10, 70)">
                    <rect x="0" y="0" width="320" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="160" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Planner (Super Agent)</text>
                </g>
            </g>

            <!-- Row 2: Skill & AI -->
            <g transform="translate(0, 150)">
                <!-- Skill Manager -->
                <rect x="0" y="0" width="340" height="130" rx="6" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
                <text x="15" y="20" font-family="Arial, sans-serif" font-weight="bold" fill="#4c1d95" font-size="13">Skill Manager</text>
                <g transform="translate(10, 30)">
                    <rect x="0" y="0" width="150" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="75" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Tool Registry</text>
                </g>
                <g transform="translate(170, 30)">
                    <rect x="0" y="0" width="160" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="80" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Code Generator</text>
                </g>
                <g transform="translate(10, 70)">
                    <rect x="0" y="0" width="320" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="160" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Skill Pipeline &amp; Versioning</text>
                </g>
            </g>

            <g transform="translate(360, 150)">
                <!-- AI Gateway -->
                <rect x="0" y="0" width="340" height="130" rx="6" fill="#ffffff" stroke="#c4b5fd" stroke-width="1" />
                <text x="15" y="20" font-family="Arial, sans-serif" font-weight="bold" fill="#4c1d95" font-size="13">AI Gateway</text>
                <g transform="translate(10, 30)">
                    <rect x="0" y="0" width="320" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="160" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Model Adapter Interface</text>
                </g>
                <g transform="translate(10, 70)">
                    <rect x="0" y="0" width="320" height="30" rx="4" fill="#ede9fe" stroke="#ddd6fe" />
                    <text x="160" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Model Configuration &amp; Keys</text>
                </g>
            </g>

            <!-- Row 3: Advanced Capabilities (New) -->
            <g transform="translate(0, 300)">
                <rect x="0" y="0" width="530" height="140" rx="6" fill="#f0fdfa" stroke="#2dd4bf" stroke-width="1" />
                <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#0f766e" font-size="13">Advanced Capabilities (Tooling Services)</text>
                
                <g transform="translate(20, 45)">
                    <!-- Office Engine -->
                    <g transform="translate(0, 0)">
                        <rect x="0" y="0" width="150" height="70" rx="4" fill="#ffffff" stroke="#99f6e4" />
                        <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" font-size="11" fill="#0f766e">Document Engine</text>
                        <text x="75" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#115e59">Word/Excel/PDF/PPT</text>
                    </g>
                    
                    <!-- Data Analysis -->
                    <g transform="translate(170, 0)">
                        <rect x="0" y="0" width="150" height="70" rx="4" fill="#ffffff" stroke="#99f6e4" />
                        <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" font-size="11" fill="#0f766e">Data Analysis</text>
                        <text x="75" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#115e59">Text-to-SQL / ChatBI</text>
                    </g>

                    <!-- Search -->
                    <g transform="translate(340, 0)">
                        <rect x="0" y="0" width="150" height="70" rx="4" fill="#ffffff" stroke="#99f6e4" />
                        <text x="75" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" font-size="11" fill="#0f766e">Search Service</text>
                        <text x="75" y="45" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#115e59">Web Search / Crawler</text>
                    </g>
                </g>
            </g>

        </g>
    </g>

    <!-- Sandbox Runtime -->
    <g transform="translate(790, 0)">
        <rect x="0" y="0" width="300" height="580" fill="#ecfeff" stroke="#06b6d4" stroke-width="2" rx="10" filter="url(#shadow)"/>
        <text x="20" y="30" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#0e7490">Sandbox Runtime</text>
        <text x="20" y="50" font-family="Arial, sans-serif" font-size="12" fill="#155e75">projects/sandbox</text>
        
        <g transform="translate(20, 100)">
             <!-- Python Engine -->
             <rect x="0" y="0" width="260" height="100" rx="6" fill="#ffffff" stroke="#a5f3fc" stroke-width="1" />
             <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#0891b2" font-size="13">Python Execution Engine</text>
             <rect x="15" y="35" width="230" height="50" rx="4" fill="#cffafe" stroke="#67e8f9" />
             <text x="130" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#0e7490">Python 3.x Env</text>
             <text x="130" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#0e7490">(Supports Data Analysis)</text>
        </g>

        <g transform="translate(20, 220)">
             <!-- Package Mgr -->
             <rect x="0" y="0" width="260" height="80" rx="6" fill="#ffffff" stroke="#a5f3fc" stroke-width="1" />
             <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#0891b2" font-size="13">Package Management</text>
             <rect x="15" y="35" width="230" height="30" rx="4" fill="#cffafe" stroke="#67e8f9" />
             <text x="130" y="54" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#0e7490">pip / requirements.txt</text>
        </g>

        <g transform="translate(20, 320)">
             <!-- Isolation -->
             <rect x="0" y="0" width="260" height="240" rx="6" fill="#f0fdf4" stroke="#86efac" stroke-width="2" stroke-dasharray="5,5" />
             <text x="130" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#15803d" font-size="13">Isolation Layer</text>
             <text x="20" y="50" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Seccomp / Seatbelt</text>
             <text x="20" y="70" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Network Policy</text>
             <text x="20" y="90" font-family="Arial, sans-serif" font-size="11" fill="#166534">• Resource Limits</text>
        </g>
    </g>

    <!-- AgentUI Build Service -->
    <g transform="translate(1120, 0)">
        <rect x="0" y="0" width="250" height="580" fill="#fefce8" stroke="#eab308" stroke-width="2" rx="10" filter="url(#shadow)"/>
        <text x="20" y="30" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#713f12">Build Service</text>
        <text x="20" y="50" font-family="Arial, sans-serif" font-size="12" fill="#854d0e">projects/agent-builder</text>

        <g transform="translate(20, 100)">
             <rect x="0" y="0" width="210" height="80" rx="6" fill="#ffffff" stroke="#fde047" stroke-width="1" />
             <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#854d0e" font-size="13">Code Generator</text>
             <text x="15" y="45" font-family="Arial, sans-serif" font-size="11" fill="#854d0e">React UI Injection</text>
        </g>

        <g transform="translate(20, 200)">
             <rect x="0" y="0" width="210" height="80" rx="6" fill="#ffffff" stroke="#fde047" stroke-width="1" />
             <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#854d0e" font-size="13">Bun Compiler</text>
             <text x="15" y="45" font-family="Arial, sans-serif" font-size="11" fill="#854d0e">Single Exe Build</text>
        </g>

        <g transform="translate(20, 300)">
             <rect x="0" y="0" width="210" height="80" rx="6" fill="#ffffff" stroke="#fde047" stroke-width="1" />
             <text x="15" y="25" font-family="Arial, sans-serif" font-weight="bold" fill="#854d0e" font-size="13">Process Mgr</text>
             <text x="15" y="45" font-family="Arial, sans-serif" font-size="11" fill="#854d0e">Hosting &amp; Restart</text>
        </g>
    </g>
  </g>

  <!-- ================================================================================== -->
  <!-- LAYER 3: PERSISTENCE LAYER -->
  <!-- ================================================================================== -->
  
  <g transform="translate(50, 900)">
      <rect x="0" y="0" width="1350" height="140" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1" rx="8" />
      <text x="20" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#64748b">PERSISTENCE LAYER</text>

      <!-- DB Node -->
      <g transform="translate(180, 40)">
          <path d="M0,15 C0,0 120,0 120,15 L120,65 C120,80 0,80 0,65 Z" fill="#ffffff" stroke="#64748b" stroke-width="2" filter="url(#shadow)"/>
          <path d="M0,15 C0,30 120,30 120,15" fill="none" stroke="#64748b" stroke-width="1" />
          <text x="60" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#334155" font-size="14">PostgreSQL</text>
          <text x="60" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">App Data + Job Queue</text>
      </g>

      <!-- Vector Node -->
      <g transform="translate(620, 40)">
          <path d="M0,15 C0,0 120,0 120,15 L120,65 C120,80 0,80 0,65 Z" fill="#ffffff" stroke="#64748b" stroke-width="2" filter="url(#shadow)"/>
          <path d="M0,15 C0,30 120,30 120,15" fill="none" stroke="#64748b" stroke-width="1" />
          <path d="M0,25 C0,40 120,40 120,25" fill="none" stroke="#64748b" stroke-width="1" />
          <text x="60" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#334155" font-size="14">Vector DB</text>
          <text x="60" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">PGVector / Milvus</text>
      </g>

      <!-- OSS Node -->
      <g transform="translate(1050, 40)">
          <path d="M0,15 C0,0 120,0 120,15 L120,65 C120,80 0,80 0,65 Z" fill="#ffffff" stroke="#64748b" stroke-width="2" filter="url(#shadow)"/>
          <path d="M0,15 C0,30 120,30 120,15" fill="none" stroke="#64748b" stroke-width="1" />
          <text x="60" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold" fill="#334155" font-size="14">Object Storage</text>
          <text x="60" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">Files &amp; Artifacts</text>
      </g>
  </g>

</svg>